const pchar_encoding = [
["0", " "], ["1", "À"], ["2", "Á"], ["3", "Â"], ["4", "Ç"], ["5", "È"], ["6", "É"], ["7", "Ê"],
["8", "Ë"], ["9", "Ì"], ["B", "Î"], ["C", "Ï"], ["D", "Ò"], ["E", "Ó"], ["F", "Ô"], ["10", "Œ"],
["11", "Ù"], ["12", "Ú"], ["13", "Û"], ["14", "Ñ"], ["15", "ß"], ["16", "à"], ["17", "á"], ["19", "ç"],
["1A", "è"], ["1B", "é"], ["1C", "ê"], ["1D", "ë"], ["1E", "ì"], ["20", "î"], ["21", "ï"], ["22", "ò"],
["23", "ó"], ["24", "ô"], ["25", "œ"], ["26", "ù"], ["27", "ú"], ["28", "û"], ["29", "ñ"], ["2A", "º"],
["2B", "ª"], ["2D", "&"], ["2E", "+"], ["34", "Lv"], ["35", "="], ["36", ";"], ["51", "¿"], ["52", "¡"],
["53", "pk"], ["54", "mn"], ["55", "po"], ["56", "ké"], ["57", "bl"], ["58", "oc"], ["59", "k"], ["5A", "Í"],
["5B", "%"], ["5C", "("], ["5D", ")"], ["68", "â"], ["6F", "í"], ["79", "U"], ["7A", "D"], ["7B", "L"],
["7C", "R"], ["85", "{offset: "], ["86", ">"], ["A1", "0"], ["A2", "1"], ["A3", "2"], ["A4", "3"], ["A5", "4"],
["A6", "5"], ["A7", "6"], ["A8", "7"], ["A9", "8"], ["AA", "9"], ["AB", "!"], ["AC", "?"], ["AD", "."],
["AE", "-"], ["AF", "·"], ["B0", "."], ["B1", '"'], ["B2", '"'], ["B3", "'"], ["B4", "'"], ["B5", "m"],
["B6", "f"], ["B7", "$"], ["B8", ","], ["B9", "x"], ["BA", "/"], ["BB", "A"], ["BC", "B"], ["BD", "C"],
["BE", "D"], ["BF", "E"], ["C0", "F"], ["C1", "G"], ["C2", "H"], ["C3", "I"], ["C4", "J"], ["C5", "K"],
["C6", "L"], ["C7", "M"], ["C8", "N"], ["C9", "O"], ["CA", "P"], ["CB", "Q"], ["CC", "R"], ["CD", "S"],
["CE", "T"], ["CF", "U"], ["D0", "V"], ["D1", "W"], ["D2", "X"], ["D3", "Y"], ["D4", "Z"], ["D5", "a"],
["D6", "b"], ["D7", "c"], ["D8", "d"], ["D9", "e"], ["DA", "f"], ["DB", "g"], ["DC", "h"], ["DD", "i"],
["DE", "j"], ["DF", "k"], ["E0", "l"], ["E1", "m"], ["E2", "n"], ["E3", "o"], ["E4", "p"], ["E5", "q"],
["E6", "r"], ["E7", "s"], ["E8", "t"], ["E9", "u"], ["EA", "v"], ["EB", "w"], ["EC", "x"], ["ED", "y"],
["EE", "z"], ["EF", ">"], ["F0", ":"], ["F1", "Ä"], ["F2", "Ö"], ["F3", "Ü"], ["F4", "ä"], ["F5", "ö"],
["F6", "ü"], ["F7", "u"], ["F8", "d"], ["F9", "l"], ["FA", "\l"], ["FB", "\p"], ["FC", "\c"], ["FD", "\v"],
["FE", "\n"], ["FF", '']];

const ascii_to_pchar_encoding = [
[" ", "0"], ["À", "1"], ["Á", "2"], ["Â", "3"], ["Ç", "4"], ["È", "5"], ["É", "6"], ["Ê", "7"],
["Ë", "8"], ["Ì", "9"], ["Î", "B"], ["Ï", "C"], ["Ò", "D"], ["Ó", "E"], ["Ô", "F"], ["Œ", "10"],
["Ù", "11"], ["Ú", "12"], ["Û", "13"], ["Ñ", "14"], ["ß", "15"], ["à", "16"], ["á", "17"], ["ç", "19"],
["è", "1A"], ["é", "1B"], ["ê", "1C"], ["ë", "1D"], ["ì", "1E"], ["î", "20"], ["ï", "21"], ["ò", "22"],
["ó", "23"], ["ô", "24"], ["œ", "25"], ["ù", "26"], ["ú", "27"], ["û", "28"], ["ñ", "29"], ["º", "2A"],
["ª", "2B"], ["&", "2D"], ["+", "2E"], ["34", "Lv"], ["=", "35"], [";", "36"], ["¿", "51"], ["¡", "52"],
["53", "pk"], ["54", "mn"], ["55", "po"], ["56", "ké"], ["57", "bl"], ["58", "oc"], ["k", "59"], ["Í", "5A"],
["%", "5B"], ["(", "5C"], [")", "5D"], ["â", "68"], ["í", "6F"], ["U", "79"], ["D", "7A"], ["L", "7B"],
["R", "7C"], ["{offset: ", "85"], [">", "86"], ["0", "A1"], ["1", "A2"], ["2", "A3"], ["3", "A4"], ["4", "A5"],
["5", "A6"], ["6", "A7"], ["7", "A8"], ["8", "A9"], ["9", "AA"], ["!", "AB"], ["?", "AC"], [".", "AD"],
["-", "AE"], ["·", "AF"], [".", "B0"], ["B1", '"'], ["B2", '"'], ["'", "B3"], ["'", "B4"], ["m", "B5"],
["f", "B6"], ["$", "B7"], [",", "B8"], ["x", "B9"], ["/", "BA"], ["A", "BB"], ["B", "BC"], ["C", "BD"],
["D", "BE"], ["E", "BF"], ["F", "C0"], ["G", "C1"], ["H", "C2"], ["I", "C3"], ["J", "C4"], ["K", "C5"],
["L", "C6"], ["M", "C7"], ["N", "C8"], ["O", "C9"], ["P", "CA"], ["Q", "CB"], ["R", "CC"], ["S", "CD"],
["T", "CE"], ["U", "CF"], ["V", "D0"], ["W", "D1"], ["X", "D2"], ["Y", "D3"], ["Z", "D4"], ["a", "D5"],
["b", "D6"], ["c", "D7"], ["d", "D8"], ["e", "D9"], ["f", "DA"], ["g", "DB"], ["h", "DC"], ["i", "DD"],
["j", "DE"], ["k", "DF"], ["l", "E0"], ["m", "E1"], ["n", "E2"], ["o", "E3"], ["p", "E4"], ["q", "E5"],
["r", "E6"], ["s", "E7"], ["t", "E8"], ["u", "E9"], ["v", "EA"], ["w", "EB"], ["x", "EC"], ["y", "ED"],
["z", "EE"], [">", "EF"], [":", "F0"], ["Ä", "F1"], ["Ö", "F2"], ["Ü", "F3"], ["ä", "F4"], ["ö", "F5"],
["ü", "F6"], ["u", "F7"], ["d", "F8"], ["l", "F9"], ["\l", "FA"], ["\p", "FB"], ["\c", "FC"], ["\v", "FD"],
["\n", "FE"], ["", "FF"]];

/* Sectors 5 through 13 */
const sector_properties = [
    {offset: 0, size: 0xF80}, {offset: 0xF80, size: 0xF80},
    {offset: 0x1F00, size: 0xF80}, {offset: 0x2E80, size: 0xF80},
    {offset: 0x3E00, size: 0xF80}, {offset: 0x4D80, size: 0xF80},
    {offset: 0x5D00, size: 0xF80}, {offset: 0x6C80, size: 0xF80},
    {offset: 0x7C00, size: 0x7D0}];

const char_encoding_map = new Map(pchar_encoding);
const revert_encoding_map = new Map(ascii_to_pchar_encoding);

/* Byte array to number representation */
function half_word(array) {
    return parseInt(array[1] + array[0], 16).toString(16);
}

function word(array) {
    return parseInt(array[3] + array[2] + array[1] + array[0], 16).toString(16);
}

/* pstr to ascii */
function pstr_ascii(array) {
    result = "";
    for (let i = 0; i < array.length; i++) {
        if (array[i] == "FF")
            break;
        result += char_encoding_map.get(array[i]);
    }
    return result;
}

/* ascii to pstr */
function ascii_from_pstr(name) {
    result = "";
    for (c in name) {
        result += revert_encoding_map.get(name[c]);
    }
    return result + "FF";
}
